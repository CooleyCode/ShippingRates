# version format
version: 0.9.9.{build}-beta

image: Visual Studio 2019

environment:
  EnableNuGetPackageRestore: true

dotnet_csproj:
  patch: true
  file: 'ShippingRates\*.csproj'
  version: '{version}'

# build configuration
build:
  project: ShippingRates.sln    # path to Visual Studio solution or project
  publish_nuget: true           # package projects with .nuspec files and push to artifacts

  # MSBuild verbosity level
  verbosity: normal

# scripts to run before build
before_build:
  - nuget restore
  - ps: $xml = [xml](Get-Content ShippingRates.Tests\App.config)
#  - ps: $xml.SelectSingleNode('//appSettings/add[@key="UPSLicenseNumber"]/@value').'#text' = $env:UPS_LICENSE_NUMBER
#  - ps: $xml.SelectSingleNode('//appSettings/add[@key="UPSUserId"]/@value').'#text' = $env:UPS_PASSWORD
#  - ps: $xml.SelectSingleNode('//appSettings/add[@key="UPSPassword"]/@value').'#text' = $env:UPS_USER_ID
  - ps: $xml.SelectSingleNode('//appSettings/add[@key="FedExKey"]/@value').'#text' = $env:FEDEX_KEY
  - ps: $xml.SelectSingleNode('//appSettings/add[@key="FedExPassword"]/@value').'#text' = $env:FEDEX_PASSWORD
  - ps: $xml.SelectSingleNode('//appSettings/add[@key="FedExAccountNumber"]/@value').'#text' = $env:FEDEX_ACCOUNT_NUMBER
  - ps: $xml.SelectSingleNode('//appSettings/add[@key="FedExMeterNumber"]/@value').'#text' = $env:FEDEX_METER_NUMBER
#  - ps: $xml.SelectSingleNode('//appSettings/add[@key="USPSUserId"]/@value').'#text' = $env:USPS_USER_ID
  - ps: set-content ShippingRates.Tests\App.config $xml.InnerXml